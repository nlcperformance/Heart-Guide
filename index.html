import React, { useState, useEffect } from 'react';
import { Heart, Activity, Timer, Zap, BookOpen, CheckCircle, ArrowRight, Brain, Dumbbell } from 'lucide-react';

export default function HeartLearningGuide() {
  const [activeTab, setActiveTab] = useState('conduction');

  return (
    <div className="min-h-screen bg-slate-50 text-slate-800 font-sans selection:bg-rose-200">
      {/* Header */}
      <header className="bg-gradient-to-r from-rose-700 to-rose-900 text-white p-6 shadow-lg">
        <div className="max-w-5xl mx-auto flex flex-col md:flex-row items-center justify-between">
          <div className="flex items-center space-x-3 mb-4 md:mb-0">
            <Heart className="w-10 h-10 text-rose-300 animate-pulse" />
            <div>
              <h1 className="text-3xl font-bold tracking-tight">Cardiac Dynamics</h1>
              <p className="text-rose-200 text-sm font-medium">OCR A Level PE ‚Ä¢ Anatomy & Physiology</p>
            </div>
          </div>
          <nav className="flex flex-wrap justify-center gap-2">
            <TabButton id="conduction" label="Conduction System" icon={<Zap size={18} />} activeTab={activeTab} setActiveTab={setActiveTab} />
            <TabButton id="cycle" label="Cardiac Cycle" icon={<Timer size={18} />} activeTab={activeTab} setActiveTab={setActiveTab} />
            <TabButton id="exercise" label="Rest to Exercise" icon={<Dumbbell size={18} />} activeTab={activeTab} setActiveTab={setActiveTab} />
            <TabButton id="exam" label="Exam Prep" icon={<BookOpen size={18} />} activeTab={activeTab} setActiveTab={setActiveTab} />
          </nav>
        </div>
      </header>

      {/* Main Content */}
      <main className="max-w-5xl mx-auto p-4 md:p-8">
        <div className="bg-white rounded-2xl shadow-xl overflow-hidden min-h-[600px] border border-slate-100">
          {activeTab === 'conduction' && <ConductionSystem />}
          {activeTab === 'cycle' && <CardiacCycle />}
          {activeTab === 'exercise' && <RestToExercise />}
          {activeTab === 'exam' && <ExamPrep />}
        </div>
      </main>

      <footer className="text-center p-6 text-slate-400 text-sm">
        <p>Interactive Study Guide for OCR A Level Physical Education</p>
      </footer>
    </div>
  );
}

function TabButton({ id, label, icon, activeTab, setActiveTab }) {
  const isActive = activeTab === id;
  return (
    <button
      onClick={() => setActiveTab(id)}
      className={`flex items-center space-x-2 px-4 py-2 rounded-full transition-all duration-200 font-medium ${
        isActive 
          ? 'bg-white text-rose-800 shadow-md transform scale-105' 
          : 'bg-rose-800/50 text-rose-100 hover:bg-rose-700'
      }`}
    >
      {icon}
      <span>{label}</span>
    </button>
  );
}

// --- MODULE 1: CONDUCTION SYSTEM ---
function ConductionSystem() {
  const [step, setStep] = useState(0);

  const steps = [
    {
      title: "1. SA Node (Sinoatrial Node)",
      desc: "Located in the right atrial wall. Known as the 'pacemaker'. It generates the electrical impulse that causes the atria to contract.",
      location: "top-right",
      highlight: "atria"
    },
    {
      title: "2. Atrial Systole",
      desc: "The wave of excitation spreads across both atria, causing them to contract and push blood into the ventricles.",
      location: "top",
      highlight: "atria"
    },
    {
      title: "3. AV Node (Atrioventricular Node)",
      desc: "Located in the septum between atria and ventricles. It delays the impulse by approx 0.1s to allow the atria to finish contracting.",
      location: "center",
      highlight: "center"
    },
    {
      title: "4. Bundle of His",
      desc: "Conducts the impulse down the septum towards the apex of the heart. Specifically splits into left and right bundle branches.",
      location: "septum",
      highlight: "ventricles"
    },
    {
      title: "5. Purkinje Fibres",
      desc: "Spread the impulse up the walls of the ventricles, causing them to contract from the apex upwards (Ventricular Systole).",
      location: "walls",
      highlight: "ventricles"
    }
  ];

  return (
    <div className="p-8">
      <div className="flex flex-col md:flex-row gap-8 items-start">
        {/* Interactive Diagram Placeholder */}
        <div className="w-full md:w-1/2 bg-slate-100 rounded-xl p-8 flex items-center justify-center relative aspect-square border-2 border-slate-200">
          {/* Abstract Heart Visualization */}
          <div className="relative w-64 h-80">
            {/* Heart Shape Base */}
            <svg viewBox="0 0 100 100" className="w-full h-full drop-shadow-xl">
              <path d="M50 30 L50 90 M20 20 Q50 10 80 20 Q90 40 50 90 Q10 40 20 20" fill="#fee2e2" stroke="#e11d48" strokeWidth="2" />
              
              {/* Chambers */}
              <path d="M20 20 Q50 10 80 20 L80 45 Q50 35 20 45 Z" fill={step <= 1 ? "#fda4af" : "#fee2e2"} className="transition-colors duration-500" />
              <path d="M20 45 Q50 35 80 45 L50 90 Z" fill={step >= 4 ? "#fda4af" : "#fee2e2"} className="transition-colors duration-500" />

              {/* Nodes and Wiring */}
              {/* SA Node */}
              <circle cx="35" cy="25" r="3" fill={step >= 0 ? "#fbbf24" : "#cbd5e1"} className={step === 0 ? "animate-ping" : ""} />
              {/* AV Node */}
              <circle cx="50" cy="40" r="3" fill={step >= 2 ? "#fbbf24" : "#cbd5e1"} className={step === 2 ? "animate-ping" : ""} />
              {/* Bundle of His */}
              <path d="M50 40 L50 60" stroke={step >= 3 ? "#fbbf24" : "#cbd5e1"} strokeWidth="2" strokeDasharray="4" />
              {/* Purkinje */}
              <path d="M50 60 L30 30 M50 60 L70 30" stroke="transparent" /> {/* Invisible guide */}
              <path d="M50 60 L30 50 L25 35" stroke={step >= 4 ? "#fbbf24" : "#cbd5e1"} strokeWidth="2" fill="none" />
              <path d="M50 60 L70 50 L75 35" stroke={step >= 4 ? "#fbbf24" : "#cbd5e1"} strokeWidth="2" fill="none" />
            </svg>
            
            {/* Labels */}
            <div className={`absolute top-6 left-6 text-xs font-bold bg-white px-2 py-1 rounded shadow transition-opacity ${step === 0 ? 'opacity-100' : 'opacity-0'}`}>SA Node</div>
            <div className={`absolute top-20 left-1/2 -translate-x-1/2 text-xs font-bold bg-white px-2 py-1 rounded shadow transition-opacity ${step === 2 ? 'opacity-100' : 'opacity-0'}`}>AV Node</div>
            <div className={`absolute bottom-20 left-1/2 -translate-x-1/2 text-xs font-bold bg-white px-2 py-1 rounded shadow transition-opacity ${step === 3 ? 'opacity-100' : 'opacity-0'}`}>Bundle of His</div>
            <div className={`absolute bottom-10 right-4 text-xs font-bold bg-white px-2 py-1 rounded shadow transition-opacity ${step === 4 ? 'opacity-100' : 'opacity-0'}`}>Purkinje Fibres</div>
          </div>
        </div>

        {/* Text Content */}
        <div className="w-full md:w-1/2 space-y-6">
          <div className="space-y-2">
            <h2 className="text-2xl font-bold text-rose-800">The Conduction System</h2>
            <p className="text-slate-600">The heart is <span className="font-bold text-rose-700">myogenic</span>, meaning it generates its own electrical impulses without external nervous stimulation.</p>
          </div>

          <div className="bg-white border-l-4 border-rose-500 shadow-sm p-6 rounded-r-lg">
            <h3 className="text-xl font-bold text-rose-700 mb-2">{steps[step].title}</h3>
            <p className="text-slate-700 text-lg leading-relaxed">{steps[step].desc}</p>
          </div>

          <div className="flex gap-4">
            <button 
              onClick={() => setStep(Math.max(0, step - 1))}
              disabled={step === 0}
              className="px-6 py-3 rounded-lg border border-slate-300 hover:bg-slate-50 disabled:opacity-50 font-medium"
            >
              Previous
            </button>
            <button 
              onClick={() => setStep(Math.min(steps.length - 1, step + 1))}
              disabled={step === steps.length - 1}
              className="px-6 py-3 rounded-lg bg-rose-600 text-white hover:bg-rose-700 disabled:opacity-50 font-medium flex-1"
            >
              Next Step
            </button>
          </div>
          
          <div className="flex gap-1 mt-4">
             {steps.map((_, i) => (
               <div key={i} className={`h-2 flex-1 rounded-full ${i <= step ? 'bg-rose-500' : 'bg-slate-200'}`} />
             ))}
          </div>
        </div>
      </div>
    </div>
  );
}

// --- MODULE 2: CARDIAC CYCLE ---
function CardiacCycle() {
  return (
    <div className="p-8">
      <div className="mb-8">
        <h2 className="text-2xl font-bold text-rose-800 mb-2">The Cardiac Cycle</h2>
        <p className="text-slate-600">One complete heartbeat takes approximately <span className="font-bold text-rose-700">0.8 seconds</span> at rest.</p>
      </div>

      <div className="grid md:grid-cols-3 gap-6">
        <CycleCard 
          title="Atrial Systole" 
          time="0.1s" 
          color="bg-blue-50 border-blue-200" 
          textColor="text-blue-800"
          desc="The atria contract. Blood is forced past the bicuspid and tricuspid valves into the ventricles."
        />
        <CycleCard 
          title="Ventricular Systole" 
          time="0.3s" 
          color="bg-rose-50 border-rose-200" 
          textColor="text-rose-800"
          desc="The ventricles contract. AV valves close (Lubb sound). Blood is forced out through the semilunar valves into the aorta and pulmonary artery."
        />
        <CycleCard 
          title="Diastole" 
          time="0.4s" 
          color="bg-green-50 border-green-200" 
          textColor="text-green-800"
          desc="Relaxation phase. Heart muscle relaxes. Semilunar valves close (Dubb sound). Atria fill with blood again."
        />
      </div>

      <div className="mt-12 bg-slate-50 p-6 rounded-xl border border-slate-200">
        <h3 className="text-lg font-bold text-slate-800 mb-4">Key Terminology Breakdown</h3>
        <div className="grid md:grid-cols-2 gap-8">
          <div>
            <h4 className="font-bold text-rose-600 mb-1">Systole</h4>
            <p className="text-slate-600">The contraction phase of the heart muscle where blood is forcibly ejected.</p>
          </div>
          <div>
            <h4 className="font-bold text-blue-600 mb-1">Diastole</h4>
            <p className="text-slate-600">The relaxation phase where the chambers fill with blood.</p>
          </div>
          <div>
            <h4 className="font-bold text-purple-600 mb-1">Stroke Volume (SV)</h4>
            <p className="text-slate-600">The volume of blood pumped out by the heart ventricles in each contraction.</p>
          </div>
          <div>
            <h4 className="font-bold text-orange-600 mb-1">Heart Rate (HR)</h4>
            <p className="text-slate-600">The number of times the heart beats per minute (bpm).</p>
          </div>
        </div>
        <div className="mt-6 p-4 bg-white rounded-lg border border-slate-200 text-center">
          <p className="font-mono text-lg font-bold text-slate-700">Cardiac Output (Q) = Stroke Volume (SV) √ó Heart Rate (HR)</p>
        </div>
      </div>
    </div>
  );
}

function CycleCard({ title, time, desc, color, textColor }) {
  return (
    <div className={`p-6 rounded-xl border-2 ${color} hover:shadow-lg transition-shadow`}>
      <div className="flex justify-between items-start mb-4">
        <h3 className={`text-xl font-bold ${textColor}`}>{title}</h3>
        <span className="bg-white px-3 py-1 rounded-full text-sm font-bold shadow-sm">{time}</span>
      </div>
      <p className="text-slate-700">{desc}</p>
    </div>
  );
}

// --- MODULE 3: REST TO EXERCISE ---
function RestToExercise() {
  const [activeTab, setActiveTab] = useState('mechanisms');

  return (
    <div className="p-8">
      <h2 className="text-2xl font-bold text-rose-800 mb-6">Response to Exercise</h2>
      
      {/* Sub-nav */}
      <div className="flex space-x-4 border-b border-slate-200 mb-6">
        <button 
          onClick={() => setActiveTab('mechanisms')} 
          className={`pb-2 px-1 ${activeTab === 'mechanisms' ? 'border-b-2 border-rose-500 font-bold text-rose-600' : 'text-slate-500'}`}
        >
          Control Mechanisms
        </button>
        <button 
          onClick={() => setActiveTab('starlings')} 
          className={`pb-2 px-1 ${activeTab === 'starlings' ? 'border-b-2 border-rose-500 font-bold text-rose-600' : 'text-slate-500'}`}
        >
          Starling's Law
        </button>
        <button 
          onClick={() => setActiveTab('data')} 
          className={`pb-2 px-1 ${activeTab === 'data' ? 'border-b-2 border-rose-500 font-bold text-rose-600' : 'text-slate-500'}`}
        >
          The Data (Rest vs Max)
        </button>
      </div>

      {activeTab === 'mechanisms' && (
        <div className="space-y-6">
          <div className="bg-orange-50 p-6 rounded-xl border border-orange-100">
            <div className="flex items-center gap-3 mb-4">
              <Brain className="text-orange-600" />
              <h3 className="text-xl font-bold text-orange-800">Cardiac Control Center (CCC)</h3>
            </div>
            <p className="text-slate-700 mb-4">Located in the <span className="font-bold">Medulla Oblongata</span> of the brain. It regulates heart rate via the Autonomic Nervous System.</p>
            
            <div className="grid md:grid-cols-2 gap-4">
              <div className="bg-white p-4 rounded-lg shadow-sm">
                <h4 className="font-bold text-green-700 mb-2">Sympathetic Nervous System</h4>
                <p className="text-sm text-slate-600">Releases <span className="font-bold">Adrenaline</span> and <span className="font-bold">Noradrenaline</span> via the Accelerator Nerve. Increases HR and contraction strength.</p>
              </div>
              <div className="bg-white p-4 rounded-lg shadow-sm">
                <h4 className="font-bold text-blue-700 mb-2">Parasympathetic Nervous System</h4>
                <p className="text-sm text-slate-600">Releases <span className="font-bold">Acetylcholine</span> via the Vagus Nerve. Slows HR down.</p>
              </div>
            </div>
          </div>

          <div className="grid md:grid-cols-3 gap-4">
            <SensorCard 
              title="Chemoreceptors" 
              desc="Detect changes in blood chemistry (increase in CO2, decrease in pH)." 
              icon="üß™"
            />
            <SensorCard 
              title="Baroreceptors" 
              desc="Detect changes in blood pressure in the aorta and carotid arteries." 
              icon="üìä"
            />
            <SensorCard 
              title="Proprioceptors" 
              desc="Detect movement in muscles and joints." 
              icon="üèÉ"
            />
          </div>
        </div>
      )}

      {activeTab === 'starlings' && (
        <div className="bg-indigo-50 p-6 rounded-xl border border-indigo-100 flex flex-col md:flex-row gap-8 items-center">
          <div className="flex-1">
            <h3 className="text-xl font-bold text-indigo-900 mb-4">Starling's Law of the Heart</h3>
            <ul className="space-y-3">
              <li className="flex gap-3">
                <ArrowRight className="text-indigo-500 flex-shrink-0" />
                <span className="text-slate-700">Increased venous return (more blood returning to heart).</span>
              </li>
              <li className="flex gap-3">
                <ArrowRight className="text-indigo-500 flex-shrink-0" />
                <span className="text-slate-700">Greater diastolic filling of the heart.</span>
              </li>
              <li className="flex gap-3">
                <ArrowRight className="text-indigo-500 flex-shrink-0" />
                <span className="text-slate-700">Cardiac muscle is stretched more.</span>
              </li>
              <li className="flex gap-3">
                <ArrowRight className="text-indigo-500 flex-shrink-0" />
                <span className="text-slate-700">More forceful contraction (Increased Ejection Fraction).</span>
              </li>
              <li className="flex gap-3">
                <CheckCircle className="text-green-500 flex-shrink-0" />
                <span className="font-bold text-indigo-900">Result: Increased Stroke Volume (SV).</span>
              </li>
            </ul>
          </div>
          <div className="w-full md:w-1/3 bg-white p-4 rounded-lg shadow-md text-center">
             <div className="text-5xl mb-2">‚ù§Ô∏è</div>
             <p className="font-bold text-slate-600">"The more you stretch it, the harder it snaps back."</p>
          </div>
        </div>
      )}

      {activeTab === 'data' && (
        <div className="overflow-hidden rounded-xl border border-slate-200">
          <table className="w-full text-left bg-white">
            <thead className="bg-rose-50 text-rose-900">
              <tr>
                <th className="p-4">Measurement</th>
                <th className="p-4">Untrained (Rest)</th>
                <th className="p-4">Elite Athlete (Rest)</th>
                <th className="p-4 bg-rose-100">Max Exercise</th>
              </tr>
            </thead>
            <tbody className="divide-y divide-slate-100 text-slate-700">
              <tr>
                <td className="p-4 font-medium">Heart Rate (bpm)</td>
                <td className="p-4">70-72</td>
                <td className="p-4">50 (Bradycardia)</td>
                <td className="p-4 bg-rose-50 font-bold">180-200</td>
              </tr>
              <tr>
                <td className="p-4 font-medium">Stroke Volume (ml)</td>
                <td className="p-4">70</td>
                <td className="p-4">100</td>
                <td className="p-4 bg-rose-50 font-bold">120-140</td>
              </tr>
              <tr>
                <td className="p-4 font-medium">Cardiac Output (L/min)</td>
                <td className="p-4">5</td>
                <td className="p-4">5</td>
                <td className="p-4 bg-rose-50 font-bold">20-40</td>
              </tr>
            </tbody>
          </table>
          <div className="p-4 bg-slate-50 text-sm text-slate-500">
            * Note: Elite athletes have a lower resting HR due to cardiac hypertrophy (bigger, stronger heart), but same cardiac output at rest due to higher SV.
          </div>
        </div>
      )}
    </div>
  );
}

function SensorCard({ title, desc, icon }) {
  return (
    <div className="bg-white p-4 rounded-xl shadow-sm border border-slate-100 hover:border-rose-200 transition-colors">
      <div className="text-2xl mb-2">{icon}</div>
      <h4 className="font-bold text-slate-800 mb-1">{title}</h4>
      <p className="text-sm text-slate-600">{desc}</p>
    </div>
  );
}

// --- MODULE 4: EXAM PREP ---
function ExamPrep() {
  const [openCard, setOpenCard] = useState(null);

  const questions = [
    {
      id: 1,
      q: "Explain how the heart controls the rate of beating (Neural Control).",
      points: "4 Marks",
      a: [
        "Controlled by the Cardiac Control Center (CCC) in the Medulla Oblongata.",
        "Sympathetic Nervous System increases HR via the Accelerator Nerve (releases adrenaline).",
        "Parasympathetic Nervous System decreases HR via the Vagus Nerve.",
        "Chemoreceptors detect increased CO2/acidity, stimulating the Sympathetic NS."
      ]
    },
    {
      id: 2,
      q: "Define 'Starling's Law of the Heart' and explain its effect on Stroke Volume during exercise.",
      points: "3 Marks",
      a: [
        "Starling's Law states that increased venous return leads to greater diastolic filling.",
        "This stretches the cardiac muscle walls.",
        "Resulting in a more forceful contraction and increased Stroke Volume."
      ]
    },
    {
      id: 3,
      q: "Describe the passage of an electrical impulse through the heart during one cardiac cycle.",
      points: "5 Marks",
      a: [
        "Impulse starts at the Sinoatrial Node (SAN) in right atrium.",
        "Causes Atrial Systole (contraction).",
        "Impulse travels to Atrioventricular Node (AVN) where it is delayed.",
        "Travels down the Bundle of His and splits into bundle branches.",
        "Reaches Purkinje Fibres causing Ventricular Systole (from apex upwards)."
      ]
    },
    {
      id: 4,
      q: "What is 'Cardiovascular Drift'?",
      points: "2 Marks",
      a: [
        "Occurs during prolonged exercise in heat.",
        "Blood volume decreases due to sweating (fluid loss).",
        "Stroke Volume decreases, so Heart Rate must increase to maintain Cardiac Output."
      ]
    }
  ];

  return (
    <div className="p-8 bg-slate-50 min-h-full">
      <div className="flex items-center gap-3 mb-8">
        <BookOpen className="text-rose-600 w-8 h-8" />
        <h2 className="text-2xl font-bold text-slate-800">OCR Exam Practice</h2>
      </div>

      <div className="grid gap-6">
        {questions.map((card) => (
          <div key={card.id} className="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
            <button 
              onClick={() => setOpenCard(openCard === card.id ? null : card.id)}
              className="w-full text-left p-6 flex justify-between items-start hover:bg-slate-50 transition-colors"
            >
              <div className="pr-4">
                <span className="inline-block bg-rose-100 text-rose-700 text-xs font-bold px-2 py-1 rounded mb-2">
                  {card.points}
                </span>
                <h3 className="font-bold text-slate-800 text-lg">{card.q}</h3>
              </div>
              <div className={`transform transition-transform duration-200 ${openCard === card.id ? 'rotate-180' : ''}`}>
                ‚ñº
              </div>
            </button>
            
            {openCard === card.id && (
              <div className="p-6 pt-0 bg-slate-50 border-t border-slate-100 animate-fadeIn">
                <h4 className="font-bold text-rose-600 mb-3">Mark Scheme / Key Points:</h4>
                <ul className="space-y-2">
                  {card.a.map((point, i) => (
                    <li key={i} className="flex gap-2 items-start text-slate-700">
                      <CheckCircle className="w-5 h-5 text-green-500 flex-shrink-0 mt-0.5" />
                      <span>{point}</span>
                    </li>
                  ))}
                </ul>
              </div>
            )}
          </div>
        ))}
      </div>
    </div>
  );
}
